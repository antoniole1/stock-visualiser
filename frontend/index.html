<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Pulse - Real-time Market Intelligence</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="icon" type="image/x-icon" href="/assets/favicons/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/assets/logos/favicon.svg">
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="brand">
                <img src="/assets/logos/stockpulse.svg" alt="Portfolio Pulse" class="brand-icon-img">
                <div>
                    <h1>Portfolio Pulse</h1>
                    <div class="tagline">Real-time Market Intelligence</div>
                </div>
            </div>
            <button class="btn-user-profile hidden" id="userProfileBtn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </button>

            <!-- PHASE 4: Portfolio Switcher Dropdown -->
            <div class="portfolio-switcher-dropdown hidden" id="portfolioSwitcher">
                <div class="switcher-header">
                    <div class="username-section">
                        <div class="username-label">Username</div>
                        <div class="username-value" id="switcherUsername">{username}</div>
                    </div>
                    <div class="switcher-divider"></div>
                </div>

                <div class="portfolios-section">
                    <div class="portfolio-list" id="portfolioList">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <div class="switcher-divider"></div>

                <button class="btn-create-portfolio" id="createPortfolioFromSwitcher">
                    Create new portfolio
                </button>

                <div class="switcher-divider"></div>

                <button class="btn-logout" id="logoutBtn">
                    Log-out
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="main-content">
            <!-- Landing View -->
            <div id="landingView" class="view active">
                <div class="setup-card">
                    <div class="setup-title">Portfolio tracker</div>
                    <div class="setup-subtitle">Access your portfolio from anywhere</div>

                    <!-- replaced full-width stacked buttons with horizontal hero actions -->
                    <div class="hero-actions">
                        <button id="createPortfolioBtn" class="btn">Create new portfolio</button>
                        <button id="findPortfolioBtn" class="btn" style="background:#1e3a8a;">Find my portfolio</button>
                    </div>
                </div>
            </div>

            <!-- Login View -->
            <div id="loginView" class="view">
                <div class="setup-card">
                    <div class="setup-title">Find your portfolio</div>
                    <div class="setup-subtitle">Enter your username and password to access your portfolio</div>

                    <form id="loginForm">
                        <div class="form-group">
                            <label class="form-label" for="loginUsername">Username</label>
                            <input
                                type="text"
                                id="loginUsername"
                                class="form-input"
                                placeholder="Enter your username"
                                autocomplete="username"
                                required
                                maxlength="50"
                            >
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="loginPassword">Password</label>
                            <input
                                type="password"
                                id="loginPassword"
                                class="form-input"
                                placeholder="Enter your password"
                                autocomplete="current-password"
                                required
                            >
                        </div>
                        <button type="submit" class="btn">Load portfolio</button>
                        <button type="button" onclick="showLanding()" class="btn" style="background: #374151; margin-top: 8px;">
                            Back
                        </button>
                    </form>
                </div>
            </div>

            <!-- Portfolio Setup View -->
            <div id="setupView" class="view">
                <div class="setup-card">
                    <div class="setup-title">Create your portfolio</div>
                    <div class="setup-subtitle">Start tracking your investments with up to 60 positions</div>

                    <form id="portfolioSetupForm">
                        <div class="form-group">
                            <label class="form-label" for="portfolioUsername">Username</label>
                            <input
                                type="text"
                                id="portfolioUsername"
                                class="form-input"
                                placeholder="Choose a memorable username"
                                autocomplete="username"
                                required
                                maxlength="50"
                            >
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="portfolioName">Portfolio name</label>
                            <input
                                type="text"
                                id="portfolioName"
                                class="form-input"
                                placeholder="e.g., Growth Portfolio, Tech Stocks, Dividend Portfolio"
                                required
                                maxlength="50"
                            >
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="portfolioPassword">Create strong password</label>
                            <input
                                type="password"
                                id="portfolioPassword"
                                class="form-input"
                                placeholder="Min 8 chars, uppercase, lowercase, number, special char"
                                autocomplete="new-password"
                                required
                                minlength="8"
                            >
                            <small style="color: #9ca3af; font-size: 0.875rem; margin-top: 4px; display: block;">
                                Password must have: uppercase, lowercase, number, and special character (!@#$%^&*)
                            </small>
                            <div id="passwordStrength" style="margin-top: 8px; display: none;">
                                <div style="height: 4px; background: #e5e7eb; border-radius: 2px; overflow: hidden;">
                                    <div id="passwordStrengthBar" style="height: 100%; width: 0%; background: #ef4444; transition: all 0.3s;"></div>
                                </div>
                                <small id="passwordStrengthText" style="color: #ef4444; font-size: 0.875rem; margin-top: 2px; display: block;"></small>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="portfolioPasswordConfirm">Confirm password</label>
                            <input
                                type="password"
                                id="portfolioPasswordConfirm"
                                class="form-input"
                                placeholder="Re-enter your password"
                                autocomplete="new-password"
                                required
                                minlength="8"
                            >
                        </div>

                        <button type="submit" class="btn">Create portfolio</button>
                        <button type="button" onclick="showLanding()" class="btn" style="background: #374151; margin-top: 8px;">
                            Back
                        </button>
                    </form>
                </div>
            </div>

            <!-- Create Portfolio View (Authenticated) -->
            <div id="createPortfolioView" class="view">
                <div class="setup-card">
                    <div class="setup-title">Create new portfolio</div>
                    <div class="setup-subtitle">Add a new portfolio to your account</div>

                    <form id="createPortfolioForm">
                        <div class="form-group">
                            <label class="form-label" for="newPortfolioName">Portfolio name</label>
                            <input
                                type="text"
                                id="newPortfolioName"
                                class="form-input"
                                placeholder="e.g., Growth Portfolio, Tech Stocks, Dividend Portfolio"
                                required
                                maxlength="50"
                            >
                        </div>

                        <button type="submit" class="btn">Create portfolio</button>
                        <button type="button" onclick="backToPortfolio()" class="btn" style="background: #374151; margin-top: 8px;">
                            Back
                        </button>
                    </form>
                </div>
            </div>

            <!-- Add Position View -->
            <div id="addPositionView" class="view">
                <div class="setup-card" style="max-width: 700px;">
                    <div class="setup-title">Add position</div>
                    <div class="setup-subtitle">Enter details for a new stock position</div>

                    <div id="successMessage" class="success-message">
                        Position added successfully!
                    </div>

                    <form id="addPositionForm">
                        <div class="form-group">
                            <label class="form-label" for="ticker">Stock ticker symbol</label>
                            <input
                                type="text"
                                id="ticker"
                                class="form-input"
                                placeholder="e.g., AAPL, GOOGL, MSFT"
                                required
                                maxlength="10"
                                style="text-transform: uppercase;"
                            >
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="shares">Number of shares</label>
                                <input
                                    type="number"
                                    id="shares"
                                    class="form-input"
                                    placeholder="100"
                                    required
                                    min="0.000001"
                                    step="0.000001"
                                >
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="purchasePrice">Purchase price per share</label>
                                <input
                                    type="number"
                                    id="purchasePrice"
                                    class="form-input"
                                    placeholder="150.00"
                                    required
                                    min="0.01"
                                    step="0.01"
                                >
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="purchaseDate">Purchase date</label>
                            <input
                                type="date"
                                id="purchaseDate"
                                class="form-input"
                                required
                            >
                        </div>

                        <div class="calculation-box">
                            <div class="calc-label">Total investment</div>
                            <div class="calc-value" id="totalInvestment">$0.00</div>
                        </div>

                        <button type="submit" class="btn" id="addPositionBtn">Add position</button>
                        <button type="button" class="btn btn-secondary" id="viewPortfolioBtn">View portfolio</button>
                    </form>
                </div>
            </div>

            <!-- Portfolio Dashboard View -->
            <div id="portfolioView" class="view">
                <!-- New header: left = portfolio name, right = metrics -->
                <div class="portfolio-header">
                    <div class="portfolio-header-left">
                        <div class="portfolio-title" id="portfolioNameDisplay">Portfolio Name</div>
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <div class="portfolio-sub" id="portfolioSubtitle">Summary</div>
                        </div>
                    </div>

                    <div class="portfolio-header-right">
                        <div class="metric-card" style="min-width:120px; padding:12px 16px;">
                            <div class="metric-label">Total value</div>
                            <div class="metric-value" id="totalValueHeader">$0.00</div>
                        </div>
                        <div class="metric-card" style="min-width:120px; padding:12px 16px;">
                            <div class="metric-label">Total invested</div>
                            <div class="metric-value" id="totalInvestedHeader">$0.00</div>
                        </div>
                        <div class="metric-card" style="min-width:140px; padding:12px 16px;">
                            <div class="metric-label">Total Gain/Loss</div>
                            <div class="metric-value" id="totalGainLossHeader">$0.00</div>
                        </div>
                        <div class="metric-card" style="min-width:120px; padding:12px 16px;">
                            <div class="metric-label">Return</div>
                            <div class="metric-value" id="totalReturnHeader">0.00%</div>
                        </div>
                        <button class="refresh-button" onclick="refreshPortfolioData()" title="Refresh portfolio data">
                            <svg class="refresh-icon" width="16" height="16" viewBox="0 0 640 640" fill="currentColor">
                                <path d="M544.1 256L552 256c4.4 0 8-3.6 8-8V72c0-4.4-3.6-8-8-8H424c-4.4 0-8 3.6-8 8v32c0 4.4 3.6 8 8 8h99.7c-44.1 47.5-108.2 76-178.7 76-137 0-248-111-248-248S208 0 345 0s248 111 248 248c0 4.4 3.6 8 8 8h32c4.4 0 8-3.6 8-8C641 114.4 558.3 0 448 0 310.6 0 193.2 106.9 193.2 241.7 193.2 376.5 310.6 483.4 448 483.4c74.1 0 143-31.5 190.1-82.4v99.9c0 4.4 3.6 8 8 8h32c4.4 0 8-3.6 8-8V264c0-4.4-3.6-8-8-8z"/>
                            </svg>
                            REFRESH
                        </button>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="tabs" role="tablist">
                    <div id="overviewTab" class="tab active" role="tab">Overview</div>
                    <div id="positionsTab" class="tab" role="tab">Positions</div>
                    <div id="newsTab" class="tab" role="tab">News</div>
                </div>

                <!-- Overview content -->
                <div id="overviewContent">
                    <div class="positions-section" style="margin-bottom: 32px;">
                        <div class="section-title">Portfolio Performance</div>
                        <div id="chartContainer" class="chart-wrapper" style="height: 400px; position: relative;">
                            <canvas id="portfolioChart"></canvas>
                            <div id="chartNoData" style="display: none; text-align: center; padding: 100px 20px; color: #9ca3af;">
                                <div style="font-size: 1.2rem; margin-bottom: 12px;">No Performance Data Available</div>
                                <div style="font-size: 0.9rem;">Historical data will appear after successfully loading stock prices</div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Positions content -->
                <div id="positionsContent" style="display:none;">
                    <div class="positions-section">
                        <div class="positions-topbar">
                            <div class="section-title" style="margin:0;">Positions</div>
                            <div>
                                <button id="addNewPositionTopBtn" class="btn-add-top">Add new stock</button>
                            </div>
                        </div>

                        <div id="positionsTableContainer">
                            <table class="positions-table">
                                <thead>
                                    <tr>
                                        <th class="sortable-header" data-sort="ticker">Ticker <span class="sort-indicator"></span></th>
                                        <th>Shares</th>
                                        <th>Purchase Price</th>
                                        <th>Current Price</th>
                                        <th class="sortable-header" data-sort="positionValue">Position Value <span class="sort-indicator"></span></th>
                                        <th class="sortable-header" data-sort="gainLoss">Gain/Loss <span class="sort-indicator"></span></th>
                                        <th class="sortable-header" data-sort="gainLossPercent">Return % <span class="sort-indicator"></span></th>
                                        <th>Purchase Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="positionsTableBody">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>


                    </div>
                </div>

                <!-- News content -->
                <div id="newsContent" style="display:none;">
                    <div class="positions-section">
                        <div class="news-controls">
                            <div class="control-group">
                                <label for="newsStockFilter">Filter by Stock:</label>
                                <select id="newsStockFilter" class="filter-select">
                                    <option value="">All Stocks</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label for="newsTimeFilter">Time Period:</label>
                                <select id="newsTimeFilter" class="filter-select">
                                    <option value="1">Last 24 Hours</option>
                                    <option value="2">Last 48 Hours</option>
                                    <option value="5" selected>Last 5 Days</option>
                                    <option value="7">Last 7 Days</option>
                                </select>
                            </div>
                        </div>
                        <div id="newsContainer" class="news-container">
                            <!-- News articles populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
            <div class="loading-card">
                <div class="loading-spinner"></div>
                <div class="loading-text">Loading Portfolio Data</div>
                <div class="loading-progress" id="loadingProgress">Fetching prices...</div>
            </div>
        </div>

        <!-- Generic Modal (populated by modal.js) -->
        <div id="genericModal" class="modal-overlay" style="display: none;"></div>
    </div>

    <script src="/js/modal.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>
